<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Drive Tracker">
  <title>Drive Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { 
      margin: 0; 
      padding: 0; 
      background: #111827; 
      overscroll-behavior: none;
      -webkit-user-select: none;
      user-select: none;
    }
    input, textarea { -webkit-user-select: auto; user-select: auto; }
    @supports(padding: max(0px)) {
      body { padding-bottom: env(safe-area-inset-bottom); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons as simple SVG components
    const PlayIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
    const SquareIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect></svg>;
    const ClockIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
    const TrendingUpIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>;
    const FuelIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" x2="15" y1="22" y2="22"></line><line x1="4" x2="14" y1="9" y2="9"></line><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"></path><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"></path></svg>;
    const SettingsIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>;
    const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>;
    const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>;
    const ChevronDownIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"></path></svg>;
    const ChevronUpIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"></path></svg>;
    const WalletIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>;
    const AlertIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" x2="12" y1="8" y2="12"></line><line x1="12" x2="12.01" y1="16" y2="16"></line></svg>;

    function DrivingTracker() {
      const [activeTab, setActiveTab] = useState('session');
      const [sessions, setSessions] = useState(() => {
        try {
          const saved = localStorage.getItem('drivingSessions');
          return saved ? JSON.parse(saved) : [];
        } catch { return []; }
      });
      const [fuelLogs, setFuelLogs] = useState(() => {
        try {
          const saved = localStorage.getItem('fuelLogs');
          return saved ? JSON.parse(saved) : [];
        } catch { return []; }
      });
      const [personalFuelLogs, setPersonalFuelLogs] = useState(() => {
        try {
          const saved = localStorage.getItem('personalFuelLogs');
          return saved ? JSON.parse(saved) : [];
        } catch { return []; }
      });
      const [mpg, setMpg] = useState(() => {
        try {
          const saved = localStorage.getItem('carMpg');
          return saved ? parseFloat(saved) : 25;
        } catch { return 25; }
      });
      
      // Load active session from localStorage on mount
      const [activeSession, setActiveSession] = useState(() => {
        try {
          const saved = localStorage.getItem('activeSession');
          return saved ? JSON.parse(saved) : null;
        } catch { return null; }
      });
      
      const [sessionEarnings, setSessionEarnings] = useState('');
      const [sessionMiles, setSessionMiles] = useState('');
      const [fuelAmount, setFuelAmount] = useState('');
      const [fuelDate, setFuelDate] = useState(new Date().toISOString().split('T')[0]);
      const [personalFuelAmount, setPersonalFuelAmount] = useState('');
      const [personalFuelDate, setPersonalFuelDate] = useState(new Date().toISOString().split('T')[0]);
      const [showSessionHistory, setShowSessionHistory] = useState(false);
      const [showFuelHistory, setShowFuelHistory] = useState(false);
      const [showPersonalFuelHistory, setShowPersonalFuelHistory] = useState(false);
      const [tempMpg, setTempMpg] = useState(mpg.toString());
      const [currentTime, setCurrentTime] = useState(new Date());

      // Update current time every second for live duration display
      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentTime(new Date());
        }, 1000);
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        try { localStorage.setItem('drivingSessions', JSON.stringify(sessions)); } catch {}
      }, [sessions]);

      useEffect(() => {
        try { localStorage.setItem('fuelLogs', JSON.stringify(fuelLogs)); } catch {}
      }, [fuelLogs]);

      useEffect(() => {
        try { localStorage.setItem('personalFuelLogs', JSON.stringify(personalFuelLogs)); } catch {}
      }, [personalFuelLogs]);

      useEffect(() => {
        try { localStorage.setItem('carMpg', mpg.toString()); } catch {}
      }, [mpg]);

      // Save active session to localStorage whenever it changes
      useEffect(() => {
        try { 
          if (activeSession) {
            localStorage.setItem('activeSession', JSON.stringify(activeSession)); 
          } else {
            localStorage.removeItem('activeSession');
          }
        } catch {}
      }, [activeSession]);

      const startSession = () => {
        const newSession = { startTime: new Date().toISOString(), endTime: null };
        setActiveSession(newSession);
      };

      const endSession = () => {
        if (activeSession) {
          setActiveSession({ ...activeSession, endTime: new Date().toISOString() });
        }
      };

      const saveSession = () => {
        if (activeSession && activeSession.endTime && sessionEarnings && sessionMiles) {
          const newSession = {
            id: Date.now(),
            startTime: activeSession.startTime,
            endTime: activeSession.endTime,
            earnings: parseFloat(sessionEarnings),
            miles: parseFloat(sessionMiles)
          };
          setSessions([newSession, ...sessions]);
          setActiveSession(null);
          setSessionEarnings('');
          setSessionMiles('');
        }
      };

      const cancelSession = () => {
        setActiveSession(null);
        setSessionEarnings('');
        setSessionMiles('');
      };

      const deleteSession = (id) => {
        setSessions(sessions.filter(s => s.id !== id));
      };

      const addFuel = () => {
        if (fuelAmount) {
          const newFuel = { id: Date.now(), date: fuelDate, gallons: parseFloat(fuelAmount) };
          setFuelLogs([newFuel, ...fuelLogs]);
          setFuelAmount('');
          setFuelDate(new Date().toISOString().split('T')[0]);
        }
      };

      const deleteFuel = (id) => {
        setFuelLogs(fuelLogs.filter(f => f.id !== id));
      };

      const addPersonalFuel = () => {
        if (personalFuelAmount) {
          const newFuel = { id: Date.now(), date: personalFuelDate, gallons: parseFloat(personalFuelAmount) };
          setPersonalFuelLogs([newFuel, ...personalFuelLogs]);
          setPersonalFuelAmount('');
          setPersonalFuelDate(new Date().toISOString().split('T')[0]);
        }
      };

      const deletePersonalFuel = (id) => {
        setPersonalFuelLogs(personalFuelLogs.filter(f => f.id !== id));
      };

      const saveMpg = () => {
        const newMpg = parseFloat(tempMpg);
        if (newMpg > 0) setMpg(newMpg);
      };

      const formatDuration = (ms) => {
        const hours = Math.floor(ms / 3600000);
        const minutes = Math.floor((ms % 3600000) / 60000);
        const seconds = Math.floor((ms % 60000) / 1000);
        if (hours > 0) {
          return `${hours}h ${minutes}m`;
        }
        return `${minutes}m ${seconds}s`;
      };

      const formatTime = (isoString) => {
        return new Date(isoString).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
      };

      const formatDate = (isoString) => {
        return new Date(isoString).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      };

      const getSessionDuration = (session) => {
        return new Date(session.endTime) - new Date(session.startTime);
      };

      const getLiveDuration = () => {
        if (!activeSession || !activeSession.startTime) return 0;
        return currentTime - new Date(activeSession.startTime);
      };

      const filterSessionsByPeriod = (period) => {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        return sessions.filter(session => {
          const sessionDate = new Date(session.startTime);
          if (period === 'today') {
            return sessionDate >= today;
          } else if (period === 'week') {
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            return sessionDate >= weekAgo;
          } else if (period === 'month') {
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            return sessionDate >= monthAgo;
          }
          return true;
        });
      };

      const filterFuelByPeriod = (period) => {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        return fuelLogs.filter(log => {
          const logDate = new Date(log.date);
          if (period === 'today') {
            return logDate >= today;
          } else if (period === 'week') {
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            return logDate >= weekAgo;
          } else if (period === 'month') {
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            return logDate >= monthAgo;
          }
          return true;
        });
      };

      const filterPersonalFuelByPeriod = (period) => {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        return personalFuelLogs.filter(log => {
          const logDate = new Date(log.date);
          if (period === 'today') {
            return logDate >= today;
          } else if (period === 'week') {
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            return logDate >= weekAgo;
          } else if (period === 'month') {
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            return logDate >= monthAgo;
          }
          return true;
        });
      };

      const calculateStats = (period) => {
        const periodSessions = filterSessionsByPeriod(period);
        const periodFuel = filterFuelByPeriod(period);
        const periodPersonalFuel = filterPersonalFuelByPeriod(period);
        
        const totalEarnings = periodSessions.reduce((sum, s) => sum + s.earnings, 0);
        const totalMiles = periodSessions.reduce((sum, s) => sum + s.miles, 0);
        const totalDuration = periodSessions.reduce((sum, s) => sum + getSessionDuration(s), 0);
        const totalHours = totalDuration / 3600000;
        
        const gallonsNeeded = totalMiles / mpg;
        const totalFueled = periodFuel.reduce((sum, f) => sum + f.gallons, 0);
        const totalPersonalFuel = periodPersonalFuel.reduce((sum, f) => sum + f.gallons, 0);
        const fuelDifference = totalFueled - gallonsNeeded - totalPersonalFuel;
        
        return {
          sessions: periodSessions.length,
          earnings: totalEarnings,
          miles: totalMiles,
          duration: totalDuration,
          perHour: totalHours > 0 ? totalEarnings / totalHours : 0,
          perMile: totalMiles > 0 ? totalEarnings / totalMiles : 0,
          gallonsNeeded,
          gallonsFueled: totalFueled,
          personalFuelPaid: totalPersonalFuel,
          fuelDifference
        };
      };

      const todayStats = calculateStats('today');
      const weekStats = calculateStats('week');
      const monthStats = calculateStats('month');
      const allTimeStats = calculateStats('all');

      const StatCard = ({ label, value, sub, color = 'text-white' }) => (
        <div className="bg-gray-800 rounded-xl p-4">
          <div className="text-gray-400 text-sm mb-1">{label}</div>
          <div className={`text-2xl font-bold ${color}`}>{value}</div>
          {sub && <div className="text-gray-500 text-xs mt-1">{sub}</div>}
        </div>
      );

      const StatsSection = ({ title, stats }) => (
        <div className="mb-6">
          <h3 className="text-lg font-semibold text-white mb-3">{title}</h3>
          <div className="grid grid-cols-2 gap-3">
            <StatCard label="Earnings" value={`$${stats.earnings.toFixed(2)}`} sub={`${stats.sessions} sessions`} color="text-green-400" />
            <StatCard label="Time" value={formatDuration(stats.duration)} sub={`${stats.miles.toFixed(1)} miles`} />
            <StatCard label="$/Hour" value={`$${stats.perHour.toFixed(2)}`} color="text-blue-400" />
            <StatCard label="$/Mile" value={`$${stats.perMile.toFixed(2)}`} color="text-blue-400" />
            <StatCard label="Gallons Needed" value={stats.gallonsNeeded.toFixed(2)} sub="for business miles" color="text-orange-400" />
            <StatCard 
              label="Personal Balance" 
              value={`${stats.fuelDifference >= 0 ? '+' : ''}${stats.fuelDifference.toFixed(2)}`} 
              sub={`${stats.personalFuelPaid.toFixed(2)} gal paid back`}
              color={stats.fuelDifference >= 0 ? 'text-yellow-400' : 'text-red-400'} 
            />
          </div>
        </div>
      );

      // Check if session was recovered from storage
      const isRecoveredSession = activeSession && !activeSession.endTime && activeSession.startTime;

      return (
        <div className="min-h-screen bg-gray-900 text-white pb-24">
          {/* Header */}
          <div className="bg-gray-800 px-4 py-6 text-center safe-top">
            <h1 className="text-2xl font-bold">Drive Tracker</h1>
            <p className="text-gray-400 text-sm mt-1">MPG: {mpg}</p>
          </div>

          {/* Content */}
          <div className="p-4">
            {activeTab === 'session' && (
              <div>
                {!activeSession ? (
                  <button
                    onClick={startSession}
                    className="w-full bg-green-600 active:bg-green-700 text-white rounded-xl py-6 flex items-center justify-center gap-3 text-xl font-semibold mb-6"
                  >
                    <PlayIcon />
                    Start Driving
                  </button>
                ) : (
                  <div className="bg-gray-800 rounded-xl p-4 mb-6">
                    {/* Recovered session indicator */}
                    {isRecoveredSession && (
                      <div className="bg-blue-900/50 border border-blue-500 rounded-lg p-3 mb-4 flex items-center gap-2">
                        <AlertIcon />
                        <span className="text-sm">Session recovered from {formatDate(activeSession.startTime)}</span>
                      </div>
                    )}
                    
                    <div className="text-center mb-4">
                      <div className="text-gray-400 text-sm">Started</div>
                      <div className="text-2xl font-bold">{formatTime(activeSession.startTime)}</div>
                      <div className="text-gray-500 text-sm">{formatDate(activeSession.startTime)}</div>
                      
                      {!activeSession.endTime && (
                        <div className="mt-4">
                          <div className="text-gray-400 text-sm">Running</div>
                          <div className="text-3xl font-bold text-green-400">{formatDuration(getLiveDuration())}</div>
                        </div>
                      )}
                      
                      {activeSession.endTime && (
                        <>
                          <div className="text-gray-400 text-sm mt-4">Ended</div>
                          <div className="text-2xl font-bold">{formatTime(activeSession.endTime)}</div>
                          <div className="text-green-400 mt-2">
                            Duration: {formatDuration(getSessionDuration(activeSession))}
                          </div>
                        </>
                      )}
                    </div>

                    {!activeSession.endTime ? (
                      <div className="space-y-3">
                        <button
                          onClick={endSession}
                          className="w-full bg-red-600 active:bg-red-700 text-white rounded-xl py-4 flex items-center justify-center gap-2 text-lg font-semibold"
                        >
                          <SquareIcon />
                          End Session
                        </button>
                        <button
                          onClick={cancelSession}
                          className="w-full bg-gray-700 active:bg-gray-600 text-white rounded-xl py-3 font-semibold text-sm"
                        >
                          Cancel Session
                        </button>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        <div>
                          <label className="text-gray-400 text-sm block mb-2">Earnings ($)</label>
                          <input
                            type="number"
                            inputMode="decimal"
                            value={sessionEarnings}
                            onChange={(e) => setSessionEarnings(e.target.value)}
                            placeholder="0.00"
                            className="w-full bg-gray-700 rounded-lg px-4 py-3 text-xl text-white border-none outline-none"
                          />
                        </div>
                        <div>
                          <label className="text-gray-400 text-sm block mb-2">Miles Driven</label>
                          <input
                            type="number"
                            inputMode="decimal"
                            value={sessionMiles}
                            onChange={(e) => setSessionMiles(e.target.value)}
                            placeholder="0.0"
                            className="w-full bg-gray-700 rounded-lg px-4 py-3 text-xl text-white border-none outline-none"
                          />
                        </div>
                        <div className="flex gap-3">
                          <button
                            onClick={cancelSession}
                            className="flex-1 bg-gray-700 active:bg-gray-600 text-white rounded-xl py-3 font-semibold"
                          >
                            Cancel
                          </button>
                          <button
                            onClick={saveSession}
                            className="flex-1 bg-green-600 active:bg-green-700 text-white rounded-xl py-3 font-semibold"
                          >
                            Save Session
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* Session History */}
                <div className="bg-gray-800 rounded-xl overflow-hidden">
                  <button
                    onClick={() => setShowSessionHistory(!showSessionHistory)}
                    className="w-full px-4 py-3 flex items-center justify-between text-left"
                  >
                    <span className="font-semibold">Session History ({sessions.length})</span>
                    {showSessionHistory ? <ChevronUpIcon /> : <ChevronDownIcon />}
                  </button>
                  {showSessionHistory && (
                    <div className="border-t border-gray-700 max-h-64 overflow-y-auto">
                      {sessions.length === 0 ? (
                        <div className="p-4 text-gray-500 text-center">No sessions yet</div>
                      ) : (
                        sessions.map(session => (
                          <div key={session.id} className="p-4 border-b border-gray-700 last:border-b-0">
                            <div className="flex justify-between items-start">
                              <div>
                                <div className="text-gray-400 text-sm">{formatDate(session.startTime)}</div>
                                <div className="text-sm">
                                  {formatTime(session.startTime)} - {formatTime(session.endTime)}
                                </div>
                                <div className="text-green-400 font-semibold">${session.earnings.toFixed(2)}</div>
                                <div className="text-gray-400 text-sm">
                                  {session.miles} mi • {formatDuration(getSessionDuration(session))}
                                </div>
                              </div>
                              <button onClick={() => deleteSession(session.id)} className="text-red-500 p-2">
                                <TrashIcon />
                              </button>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'stats' && (
              <div>
                <StatsSection title="Today" stats={todayStats} />
                <StatsSection title="This Week" stats={weekStats} />
                <StatsSection title="This Month" stats={monthStats} />
                <StatsSection title="All Time" stats={allTimeStats} />
              </div>
            )}

            {activeTab === 'fuel' && (
              <div>
                {/* Add Business Fuel */}
                <div className="bg-gray-800 rounded-xl p-4 mb-4">
                  <h3 className="font-semibold mb-4 flex items-center gap-2">
                    <FuelIcon />
                    Log Business Fuel
                  </h3>
                  <div className="space-y-4">
                    <div>
                      <label className="text-gray-400 text-sm block mb-2">Date</label>
                      <input
                        type="date"
                        value={fuelDate}
                        onChange={(e) => setFuelDate(e.target.value)}
                        className="w-full bg-gray-700 rounded-lg px-4 py-3 text-white border-none outline-none"
                      />
                    </div>
                    <div>
                      <label className="text-gray-400 text-sm block mb-2">Gallons</label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={fuelAmount}
                        onChange={(e) => setFuelAmount(e.target.value)}
                        placeholder="0.00"
                        className="w-full bg-gray-700 rounded-lg px-4 py-3 text-xl text-white border-none outline-none"
                      />
                    </div>
                    <button
                      onClick={addFuel}
                      className="w-full bg-orange-600 active:bg-orange-700 text-white rounded-xl py-3 flex items-center justify-center gap-2 font-semibold"
                    >
                      <PlusIcon />
                      Add Business Fuel
                    </button>
                  </div>
                </div>

                {/* Add Personal Fuel */}
                <div className="bg-gray-800 rounded-xl p-4 mb-4">
                  <h3 className="font-semibold mb-4 flex items-center gap-2">
                    <WalletIcon />
                    Log Personal Fuel (Pay Back)
                  </h3>
                  <div className="space-y-4">
                    <div>
                      <label className="text-gray-400 text-sm block mb-2">Date</label>
                      <input
                        type="date"
                        value={personalFuelDate}
                        onChange={(e) => setPersonalFuelDate(e.target.value)}
                        className="w-full bg-gray-700 rounded-lg px-4 py-3 text-white border-none outline-none"
                      />
                    </div>
                    <div>
                      <label className="text-gray-400 text-sm block mb-2">Gallons</label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={personalFuelAmount}
                        onChange={(e) => setPersonalFuelAmount(e.target.value)}
                        placeholder="0.00"
                        className="w-full bg-gray-700 rounded-lg px-4 py-3 text-xl text-white border-none outline-none"
                      />
                    </div>
                    <button
                      onClick={addPersonalFuel}
                      className="w-full bg-purple-600 active:bg-purple-700 text-white rounded-xl py-3 flex items-center justify-center gap-2 font-semibold"
                    >
                      <PlusIcon />
                      Add Personal Fuel
                    </button>
                  </div>
                </div>

                {/* Fuel Summary */}
                <div className="bg-gray-800 rounded-xl p-4 mb-4">
                  <h3 className="font-semibold mb-3">Fuel Summary (All Time)</h3>
                  <div className="grid grid-cols-2 gap-3">
                    <div className="bg-gray-700 rounded-lg p-3">
                      <div className="text-gray-400 text-xs">Business Gallons</div>
                      <div className="text-xl font-bold text-orange-400">{allTimeStats.gallonsNeeded.toFixed(2)}</div>
                      <div className="text-gray-500 text-xs">needed for {allTimeStats.miles.toFixed(0)} mi</div>
                    </div>
                    <div className="bg-gray-700 rounded-lg p-3">
                      <div className="text-gray-400 text-xs">Total Fueled</div>
                      <div className="text-xl font-bold text-yellow-400">{allTimeStats.gallonsFueled.toFixed(2)}</div>
                      <div className="text-gray-500 text-xs">gallons purchased</div>
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3 mt-3">
                    <div className="bg-gray-700 rounded-lg p-3">
                      <div className="text-gray-400 text-xs">Personal Paid Back</div>
                      <div className="text-xl font-bold text-purple-400">{allTimeStats.personalFuelPaid.toFixed(2)}</div>
                      <div className="text-gray-500 text-xs">gallons reconciled</div>
                    </div>
                    <div className="bg-gray-700 rounded-lg p-3">
                      <div className="text-gray-400 text-xs">Personal Balance</div>
                      <div className={`text-xl font-bold ${allTimeStats.fuelDifference >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                        {allTimeStats.fuelDifference >= 0 ? '+' : ''}{allTimeStats.fuelDifference.toFixed(2)}
                      </div>
                      <div className="text-gray-500 text-xs">
                        {allTimeStats.fuelDifference > 0.01 
                          ? 'You owe business' 
                          : allTimeStats.fuelDifference < -0.01 
                            ? 'Business owes you'
                            : 'Balanced'}
                      </div>
                    </div>
                  </div>
                </div>

                {/* Business Fuel History */}
                <div className="bg-gray-800 rounded-xl overflow-hidden mb-4">
                  <button
                    onClick={() => setShowFuelHistory(!showFuelHistory)}
                    className="w-full px-4 py-3 flex items-center justify-between text-left"
                  >
                    <span className="font-semibold">Business Fuel History ({fuelLogs.length})</span>
                    {showFuelHistory ? <ChevronUpIcon /> : <ChevronDownIcon />}
                  </button>
                  {showFuelHistory && (
                    <div className="border-t border-gray-700 max-h-48 overflow-y-auto">
                      {fuelLogs.length === 0 ? (
                        <div className="p-4 text-gray-500 text-center">No fuel logs yet</div>
                      ) : (
                        fuelLogs.map(log => (
                          <div key={log.id} className="p-4 border-b border-gray-700 last:border-b-0 flex justify-between items-center">
                            <div>
                              <div className="text-gray-400 text-sm">{new Date(log.date).toLocaleDateString()}</div>
                              <div className="text-orange-400 font-semibold">{log.gallons.toFixed(2)} gallons</div>
                            </div>
                            <button onClick={() => deleteFuel(log.id)} className="text-red-500 p-2">
                              <TrashIcon />
                            </button>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>

                {/* Personal Fuel History */}
                <div className="bg-gray-800 rounded-xl overflow-hidden">
                  <button
                    onClick={() => setShowPersonalFuelHistory(!showPersonalFuelHistory)}
                    className="w-full px-4 py-3 flex items-center justify-between text-left"
                  >
                    <span className="font-semibold">Personal Fuel History ({personalFuelLogs.length})</span>
                    {showPersonalFuelHistory ? <ChevronUpIcon /> : <ChevronDownIcon />}
                  </button>
                  {showPersonalFuelHistory && (
                    <div className="border-t border-gray-700 max-h-48 overflow-y-auto">
                      {personalFuelLogs.length === 0 ? (
                        <div className="p-4 text-gray-500 text-center">No personal fuel logs yet</div>
                      ) : (
                        personalFuelLogs.map(log => (
                          <div key={log.id} className="p-4 border-b border-gray-700 last:border-b-0 flex justify-between items-center">
                            <div>
                              <div className="text-gray-400 text-sm">{new Date(log.date).toLocaleDateString()}</div>
                              <div className="text-purple-400 font-semibold">{log.gallons.toFixed(2)} gallons</div>
                            </div>
                            <button onClick={() => deletePersonalFuel(log.id)} className="text-red-500 p-2">
                              <TrashIcon />
                            </button>
                          </div>
                        ))
                      )}
                    </div>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'settings' && (
              <div>
                <div className="bg-gray-800 rounded-xl p-4 mb-6">
                  <h3 className="font-semibold mb-4">Vehicle MPG</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="text-gray-400 text-sm block mb-2">Miles Per Gallon</label>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={tempMpg}
                        onChange={(e) => setTempMpg(e.target.value)}
                        placeholder="25"
                        className="w-full bg-gray-700 rounded-lg px-4 py-3 text-xl text-white border-none outline-none"
                      />
                    </div>
                    <button
                      onClick={saveMpg}
                      className="w-full bg-blue-600 active:bg-blue-700 text-white rounded-xl py-3 font-semibold"
                    >
                      Save MPG
                    </button>
                  </div>
                </div>

                <div className="bg-gray-800 rounded-xl p-4">
                  <h3 className="font-semibold mb-3">How It Works</h3>
                  <div className="text-gray-400 text-sm space-y-2">
                    <p><strong className="text-white">Business Gallons:</strong> Miles driven ÷ MPG = gallons needed for business</p>
                    <p><strong className="text-white">Business Fuel:</strong> Gas purchased with business money</p>
                    <p><strong className="text-white">Personal Fuel:</strong> Gas you paid for personally to reconcile</p>
                    <p><strong className="text-white">Personal Balance:</strong> Business Fuel − Business Gallons − Personal Fuel Paid</p>
                    <p><strong className="text-green-400">Positive balance</strong> = you owe the business</p>
                    <p><strong className="text-red-400">Negative balance</strong> = business owes you</p>
                    <p><strong className="text-gray-300">Zero</strong> = all squared up</p>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Bottom Navigation */}
          <div className="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 flex justify-around py-3 px-2 safe-bottom">
            <button
              onClick={() => setActiveTab('session')}
              className={`flex flex-col items-center px-4 py-1 rounded-lg ${activeTab === 'session' ? 'text-green-400' : 'text-gray-400'}`}
            >
              <ClockIcon />
              <span className="text-xs mt-1">Session</span>
            </button>
            <button
              onClick={() => setActiveTab('stats')}
              className={`flex flex-col items-center px-4 py-1 rounded-lg ${activeTab === 'stats' ? 'text-green-400' : 'text-gray-400'}`}
            >
              <TrendingUpIcon />
              <span className="text-xs mt-1">Stats</span>
            </button>
            <button
              onClick={() => setActiveTab('fuel')}
              className={`flex flex-col items-center px-4 py-1 rounded-lg ${activeTab === 'fuel' ? 'text-green-400' : 'text-gray-400'}`}
            >
              <FuelIcon />
              <span className="text-xs mt-1">Fuel</span>
            </button>
            <button
              onClick={() => setActiveTab('settings')}
              className={`flex flex-col items-center px-4 py-1 rounded-lg ${activeTab === 'settings' ? 'text-green-400' : 'text-gray-400'}`}
            >
              <SettingsIcon />
              <span className="text-xs mt-1">Settings</span>
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<DrivingTracker />, document.getElementById('root'));
  </script>
</body>
</html>
